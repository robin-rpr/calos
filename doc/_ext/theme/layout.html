{%- set lang_attr = "en" if language == None else (language|replace('_','-')) -%}
{%- set is_orphan = meta and meta.orphan is defined -%}

{%- if not embedded and docstitle -%}
{%- if title == docstitle -%}
{%- set titlesuffix = "" -%}
{%- else -%}
{%- set titlesuffix = " | "|safe + docstitle|e -%}
{%- endif -%}
{%- else -%}
{%- set titlesuffix = "" -%}
{%- endif -%}

<!DOCTYPE html>
<html lang="{{ lang_attr }}" data-content_root="{{ content_root|default('', true) }}" x-data="{activeSection: ''}">
    <head>
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <meta charset="utf-8" />
      {{ metatags }}

      {%- block htmltitle %}
      <title>{{ title|striptags|e if title else docstitle }}{{ titlesuffix }}</title>
      <meta property="og:title" content="{{ title|striptags|e if title else docstitle }}{{ titlesuffix }}" />
      <meta name="twitter:title" content="{{ title|striptags|e if title else docstitle }}{{ titlesuffix }}" />
      {%- endblock htmltitle %}

      <!-- CSS -->
      {%- for css in css_files %}
      {%- if css|attr("filename") %}
      {{ css_tag(css) }}
      {%- else -%}
      <link rel="stylesheet" href="{{ pathto(css, 1)|e }}" />
      {%- endif %}
      {%- endfor %}

      <!-- JS -->
      <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.9/dist/cdn.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@alpinejs/intersect@3.14.9/dist/cdn.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script>

      {%- if pageurl %}
      <link rel="canonical" href="{{ pageurl|e }}" />
      {%- endif %}

      {%- if favicon_url %}
      <link rel="icon" href="{{ favicon_url|e }}" />
      {%- endif %}

      {%- block linktags %}

      {%- if next %}
      <link rel="next" title="{{ next.title|striptags|e }}" href="{{ next.link|e }}" />
      {%- endif %}

      {%- if prev %}
      <link rel="prev" title="{{ prev.title|striptags|e }}" href="{{ prev.link|e }}" />
      {%- endif %}

      {%- endblock linktags %}
      {%- block extrahead %}{%- endblock extrahead %}

      <style>
        /* Alpine.js */
        /* Hide Alpine.js components until they're loaded */
        [x-cloak] {
            display: none !important;
        }
      </style>
      <style>
        /* Sphinx Design */
        /* Overrides for the `sphinx-design` extension */
        :root {
          --sd-color-tabs-label-active: var(--foreground);
          --sd-color-tabs-underline-active: var(--accent-foreground);
          --sd-color-tabs-label-hover: var(--accent-foreground);
          --sd-color-tabs-overline: var(--border);
          --sd-color-tabs-underline: var(--border);
        }

        .sd-card {
          margin-top: 1.5rem;
          border-radius: 0.5rem;
          border: 1px solid var(--border);
          background-color: var(--card);
          color: var(--card-foreground);
        }

        .sd-container-fluid {
          margin-top: 1.5rem;
          margin-bottom: 1.5rem;
        }

        .sd-card-title {
          font-weight: 600 !important;
        }

        .sd-summary-title {
          font-weight: 500 !important;
          color: var(--muted-foreground);
        }

        .sd-card-header,
        .sd-card-footer {
          font-size: 0.875rem;
        }

        .sd-tab-set {
          margin-top: 1.5rem;
        }

        .sd-tab-content > p {
          margin-bottom: 1.5rem;
        }

        .sd-tab-content pre:first-of-type {
          margin-top: 0;
        }

        .sd-tab-set > label {
          font-weight: 500;
          letter-spacing: 0.05em;
        }

        details.sd-dropdown:not([open]) > .sd-card-header,
        details.sd-dropdown {
          border-color: var(--border);
        }

        details.sd-dropdown summary:focus {
          outline: auto;
        }

        .sd-cards-carousel {
          overflow-x: auto;
        }

        .sd-shadow-sm {
          box-shadow: none !important;
        }
      </style>

      <script>
        /* Alpine.js */
        Alpine.plugin(intersect);
        Alpine.start();
      </script>

      <script>
        /* Clipboard.js */
        window.addEventListener("DOMContentLoaded", () => {
          const copyIcon =
            '<svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 96 960 960" fill="currentColor" stroke="none" class="copy-icon"><path d="M200 976q-33 0-56.5-23.5T120 896V376q0-17 11.5-28.5T160 336q17 0 28.5 11.5T200 376v520h400q17 0 28.5 11.5T640 936q0 17-11.5 28.5T600 976H200Zm160-160q-33 0-56.5-23.5T280 736V256q0-33 23.5-56.5T360 176h360q33 0 56.5 23.5T800 256v480q0 33-23.5 56.5T720 816H360Zm0-80h360V256H360v480Zm0 0V256v480Z"/></svg>';
          const successIcon =
            '<svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 96 960 960" fill="currentColor" stroke="none" class="copy-success-icon"><path d="M382 799q-8 0-15-2.5t-13-8.5L182 616q-11-11-10.5-28.5T183 559q11-11 28-11t28 11l143 143 339-339q11-11 28.5-11t28.5 11q11 11 11 28.5T778 420L410 788q-6 6-13 8.5t-15 2.5Z"/></svg>';
          const btn = `<button class="copy copy-button tooltipped tooltipped-n" data-tooltip="Copy code" type="button"><span class="sr-only">Copy code</span>${copyIcon}${successIcon}</button>`;

          /** Add copy buttons to code blocks */
          const highlighted = document.querySelectorAll(".highlight, .literal-block");
          if (!highlighted) {
            return;
          }

          highlighted.forEach((item) => {
            const pre = item.querySelector("pre");
            if (pre) {
              pre.insertAdjacentHTML("beforeend", btn);
            } else {
              item.insertAdjacentHTML("beforeend", btn);
            }
          });

          const clipboard = new ClipboardJS("button.copy", {
            target: (trigger) => {
              return trigger.parentElement;
            },
          });

          clipboard.on("success", ({ trigger }) => {
            const tooltip = trigger.getAttribute("data-tooltip");
            const copyIcon = trigger.querySelector(".copy-icon");
            const successIcon = trigger.querySelector(".copy-success-icon");
            swapIcons(copyIcon, successIcon);
            trigger.setAttribute("data-tooltip", "Copied!");

            setTimeout(() => {
              swapIcons(successIcon, copyIcon);
              trigger.setAttribute("data-tooltip", tooltip);
            }, 2000);
          });

          function swapIcons(first, second) {
            first.classList.remove("scale-100");
            second.classList.add("scale-100");
            first.classList.add("scale-0");
            second.classList.remove("scale-0");
          }
        });
      </script>
    </head>

    <body
        x-data="{ showSidebar: false, showScrollTop: false }"
        :class="{ 'body--sidebar-open': showSidebar }"
        {%- if theme_show_scrolltop|tobool -%}
            @scroll.window="showScrollTop = pageYOffset > 100"
        {%- endif -%}
      >

        {%- if not is_orphan -%}
        <div id="overlay" x-cloak x-show="showSidebar"
            @click.self="showSidebar = false">
            <!-- A blurry background screen for the mobile sidebar -->
        </div>
        {%- endif -%}

        <main id="main">
            <a id="skip" href="#content" >
                Skip to content
            </a>

            {%- block header %}
                {%- include "header.html" %}
            {%- endblock header %}

            {%- if is_orphan -%}
            <div id="content" orphan>
                {{ body}}
            </div>
            {%- else -%}
            <div id="content">
                {%- block sidebar %}
                    {%- include "sidebar.html" %}
                {%- endblock sidebar %}

                <div>
                  {{ body }}
                </div>
            </div>
            {%- endif -%}

            {%- block footer %}
            {%- include "footer.html" %}
            {%- endblock footer %}

            {%- if theme_show_scrolltop|tobool %}
            {%- include "scrolltop.html" %}
            {%- endif %}
            
            {% block scripts %}
            {%- for js in script_files %}
            {{ js_tag(js) }}
            {%- endfor %}
            {% endblock scripts %}
        </main>
    </body>
</html>
